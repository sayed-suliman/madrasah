{{>header}}


{{>navbar}}

{{>sidebar}}

<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <div class="container-full">
        <!-- Content Header (Page header) -->
        <div class="content-header">
            <div class="d-flex align-items-center">
                <div class="me-auto">
                    <h3 class="page-title">{{name}}</h3>
                </div>

            </div>
        </div>

        <!-- Main content -->
        <section class="content">
            <div class="row">
                <div class="box">
                    <!-- /.box-header -->
                    <div class="box-body">
                        <div class="table-responsive">
                            <table id="example"
                                class="table table-bordered table-hover display nowrap margin-top-10 w-p100">
                                <thead>
                                    <tr>
                                        <th>نام</th>
                                        <th>amount</th>
                                        <th>حالت</th>
                                        <th>کارروائی</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{#each fees}}
                                    <tr>
                                        <td>{{this.fee.name}}</td>
                                        <td>{{this.fee.amount}}</td>
                                        <td>
                                            {{#ifEqual this.status 'pending'}}
                                            <div class="px-25 py-10 w-100">
                                                <span class="badge badge-danger">بلا معاوضہ</span>
                                            </div>
                                            {{else}}
                                            <div class="px-25 py-10 w-100">
                                                <span class="badge badge-success">ادا کیا</span>
                                            </div>
                                            {{/ifEqual}}
                                        </td>
                                        <td>
                                            {{#ifEqual this.status 'pending'}}
                                            <button class="btn btn-success px-2 py-1 me-1 send-btn"
                                                data-user-id="{{../id}}" data-fee-id="{{this._id}}">pay
                                                <i class="mdi mdi-account-edit"></i></button>
                                            {{else}}
                                            <button class="btn btn-success px-2 py-1 me-1 disabled">paid
                                                <i class="mdi mdi-account-edit"></i></button>
                                            {{/ifEqual}}
                                        </td>
                                    </tr>
                                    {{/each}}
                                </tbody>
                            </table>

                        </div>
                    </div>
                    <!-- /.box-body -->
                </div>
            </div>
            <!-- /.row -->

        </section>
        <!-- /.content -->
    </div>
</div>


{{!-- Paid Fee Modal --}}
<div class="modal center-modal fade" id="add-fee-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Paid fee title</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="box">
                    <div class="box-header with-border">
                        <h4 class="box-title">طالب علم شامل کرنے کا فارم</h4>
                    </div>
                    <!-- /.box-header -->
                    <form class="form-fee" method="post" action="/fee/addfee">
                        <div class="box-body">
                            <h4 class="box-title text-info mb-0"><i class="ti-user me-15"></i> ذاتی معلومات</h4>
                            <hr class="my-15">
                            <input type="hidden" value="{{id}}" name="class">
                            <div class="form-group">
                                <label class="form-label">Type/Name</label>
                                <input type="text" name="name" value="" required class="form-control">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Amount</label>
                                <input type="number" name="amount" value="" required class="form-control">
                            </div>
                            {{!-- Date --}}
                            {{!-- <div class="form-group row">
                                <label for="date" class="form-label">Date</label>
                                <input class="form-control eng" name="date" type="date" id="date">
                            </div> --}}
                        </div>
                        <!-- /.box-body -->
                        <div class="box-footer">
                            <button type="submit" class="btn btn-primary" fdprocessedid="ecljau">
                                <i class="ti-save-alt"></i> جمع کریں
                            </button>
                            <button type="reset" class="btn btn-warning me-1" fdprocessedid="lzzut">
                                <i class="ti-trash"></i> صاف کریں
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer modal-footer-uniform">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                {{!-- <button type="button" class="btn btn-primary float-end">Save changes</button> --}}
            </div>
        </div>
    </div>
</div>





{{>footer}}

{{!-- scripts --}}
<!-- Page Content overlay -->


<!-- Vendor JS -->
<script src="/vendor_components/sweetalert/sweetalert.min.js"></script>
<script src="/vendor_components/sweetalert/jquery.sweet-alert.custom.js"></script>
<script>
    $(document).ready(function () {


        $('.send-btn').click(function () {
            let feeId = $(this).data('fee-id');
            let userId = $(this).data('user-id');
            console.log('feeId : ', feeId, ' :: userId : ', userId);
            const data = { userId, feeId }
            // AJAX request to submit form data

            // -------------------------------------------------------------- start swal
            swal({
                title: "Are you sure?",
                text: "This action can't be undone!",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Confirm!",
                cancelButtonText: "No, cancel!",
                closeOnConfirm: false,
                closeOnCancel: false,
            }, function (isConfirm) {
                if (isConfirm) {
                    $.ajax({
                        type: 'patch', // Get the form's method attribute
                        url: `/fee/student`, // Get the form's action attribute
                        data: data,
                        success: function (response) {
                            swal("Paid!", "The given student had paid this fee", "success");
                            setTimeout(function () {
                                window.location.reload();
                            }, 1000)
                        },
                        error: function (error) {
                            // Handle error response if needed
                            swal("Cancelled", `Can't paid:)  ${error} `, 'error');
                        }
                    });

                    //end ajax

                } else {
                    swal("Cancelled", "Your imaginary file is safe :)", "error");
                }
            });

            // end swal

            $.ajax({
                type: 'patch', // Get the form's method attribute
                url: `/fee/student`, // Get the form's action attribute
                data: data,
                success: function (response) {

                },
                error: function (error) {
                    // Handle error response if needed
                    console.error("Error submitting form:", error);
                }
            });

            //end ajax



        });
    });
</script>